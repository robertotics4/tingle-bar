{"ast":null,"code":"import _regeneratorRuntime from\"/home/roberto/\\xC1rea de Trabalho/tingle-bar/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/roberto/\\xC1rea de Trabalho/tingle-bar/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/roberto/\\xC1rea de Trabalho/tingle-bar/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useContext}from'react';import Swal from'sweetalert2';import AuthEstabelecimentoContext from'../../../../contexts/auth-estabelecimento';import GeralContext from'../../../../contexts/geral';import api from'../../../../services/api';import Loading from'../../../../components/Loading';export default function ListaFuncionarios(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),funcionarios=_useState2[0],setFuncionarios=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),estabelecimento=_useState4[0],setEstabelecimento=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),tiposFuncionario=_useState6[0],setTiposFuncionario=_useState6[1];var _useContext=useContext(GeralContext),isLoadingVisible=_useContext.isLoadingVisible,setLoadingVisible=_useContext.setLoadingVisible;useEffect(function(){function loadStoragedData(){return _loadStoragedData.apply(this,arguments);}function _loadStoragedData(){_loadStoragedData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var storagedEstabelecimento;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:storagedEstabelecimento=localStorage.getItem('@TBAuth:estabelecimento');if(storagedEstabelecimento){setEstabelecimento(JSON.parse(storagedEstabelecimento));}case 2:case\"end\":return _context.stop();}}},_callee);}));return _loadStoragedData.apply(this,arguments);}loadStoragedData();getTiposFuncionario();},[]);useEffect(function(){getFuncionarios();},[estabelecimento]);function getFuncionarios(){return _getFuncionarios.apply(this,arguments);}function _getFuncionarios(){_getFuncionarios=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var response;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return api.get('/Funcionario?idEstabelecimento='+estabelecimento.id_Estabelecimento);case 3:response=_context2.sent;setFuncionarios(response.data);return _context2.abrupt(\"return\",response.data);case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](0);return _context2.abrupt(\"return\",_context2.t0.response);case 11:case\"end\":return _context2.stop();}}},_callee2,null,[[0,8]]);}));return _getFuncionarios.apply(this,arguments);}function getTiposFuncionario(){return _getTiposFuncionario.apply(this,arguments);}function _getTiposFuncionario(){_getTiposFuncionario=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var response;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return api.get('/tipofuncionario');case 3:response=_context3.sent;setTiposFuncionario(response.data);return _context3.abrupt(\"return\",response.data);case 8:_context3.prev=8;_context3.t0=_context3[\"catch\"](0);return _context3.abrupt(\"return\",_context3.t0.response);case 11:case\"end\":return _context3.stop();}}},_callee3,null,[[0,8]]);}));return _getTiposFuncionario.apply(this,arguments);}function getUsuario(_x){return _getUsuario.apply(this,arguments);}function _getUsuario(){_getUsuario=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(cpf){var response;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;_context4.next=3;return api.get('/usuario/GetByCpf?Cpf='+cpf);case 3:response=_context4.sent;return _context4.abrupt(\"return\",response.data);case 7:_context4.prev=7;_context4.t0=_context4[\"catch\"](0);return _context4.abrupt(\"return\",_context4.t0.response);case 10:case\"end\":return _context4.stop();}}},_callee4,null,[[0,7]]);}));return _getUsuario.apply(this,arguments);}function cadastrarFuncionario(_x2,_x3){return _cadastrarFuncionario.apply(this,arguments);}function _cadastrarFuncionario(){_cadastrarFuncionario=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(idUsuario,idTipoFuncionario){var payload,response;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:payload={\"id_usuario\":idUsuario,\"id_estabelecimento\":estabelecimento.id_Estabelecimento,\"id_tipofuncionario\":idTipoFuncionario};_context5.prev=1;_context5.next=4;return api.post('/Funcionario',payload);case 4:response=_context5.sent;if(response.status===201||response.status===200){Swal.fire('Sucesso!','Funcionário cadastrado com sucesso!','success');getFuncionarios();}_context5.next=11;break;case 8:_context5.prev=8;_context5.t0=_context5[\"catch\"](1);if(_context5.t0.response.status===401||_context5.t0.response.status===400){Swal.fire('Erro!','Falha ao cadastrar o funcionário','error');}case 11:case\"end\":return _context5.stop();}}},_callee5,null,[[1,8]]);}));return _cadastrarFuncionario.apply(this,arguments);}function handleCadastrar(){return _handleCadastrar.apply(this,arguments);}function _handleCadastrar(){_handleCadastrar=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(){return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:Swal.mixin({input:'text',confirmButtonText:'Pesquisar',showCancelButton:true,progressSteps:['1'],inputValidator:function inputValidator(value){return new Promise(function(resolve){if(value){resolve();}else{resolve('CPF inválido');}});}}).queue([{title:'Pesquisar Usuário',text:'Digite o CPF',input:'text',inputPlaceholder:\"000.000.000-00\"}]).then(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(result){var cpf,pesquisaUsuario,_Swal$fire$then,value;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:if(!result.value){_context6.next=12;break;}_context6.prev=1;cpf=result.value[0];_context6.next=5;return getUsuario(cpf);case 5:pesquisaUsuario=_context6.sent;if(pesquisaUsuario.cpf){_Swal$fire$then=Swal.fire({title:'Cadastrar Funcionário',html:\"Nome: \".concat(pesquisaUsuario.nome,\"\\n                                    <pre>cpf: \").concat(pesquisaUsuario.cpf,\"</pre>\"),input:'select',inputOptions:tiposFuncionario.map(function(item){return item.descricao;}),inputPlaceholder:'Selecione a função',confirmButtonText:'Cadastrar',showCancelButton:true,inputValidator:function inputValidator(value){return new Promise(function(resolve){if(value)resolve();else resolve('Você precisa selecionar uma função');});}}).then(function(result){var idTipoFuncionario=tiposFuncionario[result.value].id;cadastrarFuncionario(pesquisaUsuario.id,idTipoFuncionario);}),value=_Swal$fire$then.value;}else{Swal.fire('CPF não localizado','Tente novamente','error');}_context6.next=12;break;case 9:_context6.prev=9;_context6.t0=_context6[\"catch\"](1);Swal.fire('CPF não localizado','Tente novamente','error');case 12:case\"end\":return _context6.stop();}}},_callee6,null,[[1,9]]);}));return function(_x5){return _ref.apply(this,arguments);};}());case 1:case\"end\":return _context7.stop();}}},_callee7);}));return _handleCadastrar.apply(this,arguments);}function deletarFuncionario(_x4){return _deletarFuncionario.apply(this,arguments);}function _deletarFuncionario(){_deletarFuncionario=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(item){return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:Swal.fire({title:'Deseja deletar o funcionário?',text:\"Após deletar não será possivel recuperar!\",icon:'warning',showCancelButton:true,confirmButtonColor:'#d33',cancelButtonColor:'#3085d6',confirmButtonText:'Deletar'}).then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(result){var response;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:if(!result.value){_context8.next=11;break;}_context8.prev=1;_context8.next=4;return api.delete('/Funcionario/'+item.id_funcionario);case 4:response=_context8.sent;if(response.status===201||response.status===200){Swal.fire('Sucesso!','Funcionário deletado com sucesso!','success');getFuncionarios();}_context8.next=11;break;case 8:_context8.prev=8;_context8.t0=_context8[\"catch\"](1);if(_context8.t0.response.status===401||_context8.t0.response.status===400){Swal.fire('Erro!','Falha ao deletar o funcionário','error');}case 11:case\"end\":return _context8.stop();}}},_callee8,null,[[1,8]]);}));return function(_x6){return _ref2.apply(this,arguments);};}());case 1:case\"end\":return _context9.stop();}}},_callee9);}));return _deletarFuncionario.apply(this,arguments);}return/*#__PURE__*/React.createElement(\"div\",{className:\"content-wrapper\"},/*#__PURE__*/React.createElement(\"section\",{className:\"content-header\"},/*#__PURE__*/React.createElement(\"div\",{className:\"container-fluid\"},/*#__PURE__*/React.createElement(\"div\",{className:\"row mb-2\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col-sm-6\"},/*#__PURE__*/React.createElement(\"h1\",null,\"Funcion\\xE1rios\")),/*#__PURE__*/React.createElement(\"div\",{className:\"col-sm-6\"},/*#__PURE__*/React.createElement(\"ol\",{className:\"breadcrumb float-sm-right\"},/*#__PURE__*/React.createElement(\"li\",{className:\"breadcrumb-item\"},/*#__PURE__*/React.createElement(\"a\",{href:\"#\"},\"Home\")),/*#__PURE__*/React.createElement(\"li\",{className:\"breadcrumb-item active\"},\"Funcion\\xE1rios\")))))),/*#__PURE__*/React.createElement(\"section\",{className:\"content\"},/*#__PURE__*/React.createElement(\"div\",{className:\"container-fluid\"},/*#__PURE__*/React.createElement(\"div\",{className:\"card\"},/*#__PURE__*/React.createElement(\"div\",{className:\"card-header\"},/*#__PURE__*/React.createElement(\"h3\",{className:\"card-title\"},\"Lista de funcion\\xE1rios\"),/*#__PURE__*/React.createElement(\"div\",{className:\"card-tools\"},/*#__PURE__*/React.createElement(\"button\",{className:\"btn btn-success btn-sm\",onClick:handleCadastrar},/*#__PURE__*/React.createElement(\"i\",{className:\"fas fa-user-plus mr-2\"}),\"Novo\"))),/*#__PURE__*/React.createElement(\"div\",{className:\"card-body p-0\"},/*#__PURE__*/React.createElement(\"table\",{className:\"table table-striped projects\"},/*#__PURE__*/React.createElement(\"thead\",null,/*#__PURE__*/React.createElement(\"tr\",null,/*#__PURE__*/React.createElement(\"th\",{style:{width:'10%'}},\"ID\"),/*#__PURE__*/React.createElement(\"th\",{style:{width:'40%'}},\"Nome\"),/*#__PURE__*/React.createElement(\"th\",{style:{width:'20%'}},\"Tipo\"),/*#__PURE__*/React.createElement(\"th\",{style:{width:'30%'}}))),/*#__PURE__*/React.createElement(\"tbody\",null,funcionarios.map(function(item,index){return/*#__PURE__*/React.createElement(\"tr\",{key:item.id_funcionario},/*#__PURE__*/React.createElement(\"td\",{name:\"idFuncionario\"},item.id_funcionario),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"a\",null,item.nome),/*#__PURE__*/React.createElement(\"br\",null)),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"a\",null,item.descricao)),/*#__PURE__*/React.createElement(\"td\",{className:\"project-actions text-right\"},/*#__PURE__*/React.createElement(\"button\",{disabled:true,className:\"btn btn-primary btn-sm ml-3\"},/*#__PURE__*/React.createElement(\"i\",{className:\"fas fa-eye mr-2\"}),\"Visualizar\"),/*#__PURE__*/React.createElement(\"button\",{className:\"btn btn-danger btn-sm ml-3\",onClick:function onClick(){return deletarFuncionario(item);}},/*#__PURE__*/React.createElement(\"i\",{className:\"fas fa-trash mr-2\"}),\"Deletar\")));}))))))),isLoadingVisible?/*#__PURE__*/React.createElement(Loading,null):null);}","map":{"version":3,"sources":["/home/roberto/Área de Trabalho/tingle-bar/src/pages/PainelEstabelecimento/pages/GerenciarFuncionarios/ListaFuncionarios.jsx"],"names":["React","useState","useEffect","useContext","Swal","AuthEstabelecimentoContext","GeralContext","api","Loading","ListaFuncionarios","funcionarios","setFuncionarios","estabelecimento","setEstabelecimento","tiposFuncionario","setTiposFuncionario","isLoadingVisible","setLoadingVisible","loadStoragedData","storagedEstabelecimento","localStorage","getItem","JSON","parse","getTiposFuncionario","getFuncionarios","get","id_Estabelecimento","response","data","getUsuario","cpf","cadastrarFuncionario","idUsuario","idTipoFuncionario","payload","post","status","fire","handleCadastrar","mixin","input","confirmButtonText","showCancelButton","progressSteps","inputValidator","value","Promise","resolve","queue","title","text","inputPlaceholder","then","result","pesquisaUsuario","html","nome","inputOptions","map","item","descricao","id","deletarFuncionario","icon","confirmButtonColor","cancelButtonColor","delete","id_funcionario","width","index"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useContext } from 'react';\nimport Swal from 'sweetalert2';\n\nimport AuthEstabelecimentoContext from '../../../../contexts/auth-estabelecimento';\nimport GeralContext from '../../../../contexts/geral';\n\nimport api from '../../../../services/api';\nimport Loading from '../../../../components/Loading';\n\nexport default function ListaFuncionarios() {\n    const [funcionarios, setFuncionarios] = useState([]);\n    const [estabelecimento, setEstabelecimento] = useState([]);\n    const [tiposFuncionario, setTiposFuncionario] = useState([]);\n    const { isLoadingVisible, setLoadingVisible } = useContext(GeralContext);\n\n    useEffect(() => {\n        async function loadStoragedData() {\n            const storagedEstabelecimento = localStorage.getItem('@TBAuth:estabelecimento');\n\n            if (storagedEstabelecimento) {\n                setEstabelecimento(JSON.parse(storagedEstabelecimento));\n            }\n        }\n\n        loadStoragedData();\n        getTiposFuncionario();\n    }, []);\n\n    useEffect(() => {\n        getFuncionarios();\n    }, [estabelecimento]);\n\n    async function getFuncionarios() {\n        try {\n            const response = await api.get('/Funcionario?idEstabelecimento=' + estabelecimento.id_Estabelecimento);\n            setFuncionarios(response.data);\n            return response.data;\n        } catch (err) {\n            return err.response;\n        }\n    }\n\n    async function getTiposFuncionario() {\n        try {\n            const response = await api.get('/tipofuncionario');\n            setTiposFuncionario(response.data);\n            return response.data;\n        } catch (err) {\n            return err.response;\n        }\n    }\n\n    async function getUsuario(cpf) {\n        try {\n            const response = await api.get('/usuario/GetByCpf?Cpf=' + cpf);\n            return response.data;\n        } catch (err) {\n            return err.response;\n        }\n    }\n\n    async function cadastrarFuncionario(idUsuario, idTipoFuncionario) {\n        const payload = {\n            \"id_usuario\": idUsuario,\n            \"id_estabelecimento\": estabelecimento.id_Estabelecimento,\n            \"id_tipofuncionario\": idTipoFuncionario\n        }\n\n        try {\n            const response = await api.post('/Funcionario', payload);\n\n            if (response.status === 201 || response.status === 200) {\n                Swal.fire('Sucesso!', 'Funcionário cadastrado com sucesso!', 'success');\n                getFuncionarios();\n            }\n\n        } catch (err) {\n            if (err.response.status === 401 || err.response.status === 400) {\n                Swal.fire('Erro!', 'Falha ao cadastrar o funcionário', 'error')\n            }\n        }\n    }\n\n    async function handleCadastrar() {\n        Swal.mixin({\n            input: 'text',\n            confirmButtonText: 'Pesquisar',\n            showCancelButton: true,\n            progressSteps: ['1'],\n            inputValidator: value => {\n                return new Promise(resolve => {\n                    if (value) {\n                        resolve()\n                    } else {\n                        resolve('CPF inválido');\n                    }\n                });\n            }\n        }).queue([\n            {\n                title: 'Pesquisar Usuário',\n                text: 'Digite o CPF',\n                input: 'text',\n                inputPlaceholder: \"000.000.000-00\",\n            }\n        ]).then(async result => {\n            if (result.value) {\n                try {\n                    const cpf = (result.value[0])\n                    const pesquisaUsuario = await getUsuario(cpf);\n\n                    if (pesquisaUsuario.cpf) {\n                        const { value } = Swal.fire({\n                            title: 'Cadastrar Funcionário',\n                            html: `Nome: ${pesquisaUsuario.nome}\n                                    <pre>cpf: ${pesquisaUsuario.cpf}</pre>`,\n                            input: 'select',\n                            inputOptions: tiposFuncionario.map(item => item.descricao),\n                            inputPlaceholder: 'Selecione a função',\n                            confirmButtonText: 'Cadastrar',\n                            showCancelButton: true,\n                            inputValidator: (value) => {\n                                return new Promise((resolve) => {\n                                    if (value)\n                                        resolve()\n                                    else\n                                        resolve('Você precisa selecionar uma função');\n                                });\n                            }\n                        }).then(result => {\n                            const idTipoFuncionario = tiposFuncionario[result.value].id;\n                            cadastrarFuncionario(pesquisaUsuario.id, idTipoFuncionario);\n                        });\n                    } else {\n                        Swal.fire('CPF não localizado', 'Tente novamente', 'error');\n                    }\n                } catch (err) {\n                    Swal.fire('CPF não localizado', 'Tente novamente', 'error');\n                }\n            }\n        });\n    }\n\n    async function deletarFuncionario(item) {\n        Swal.fire({\n            title: 'Deseja deletar o funcionário?',\n            text: \"Após deletar não será possivel recuperar!\",\n            icon: 'warning',\n            showCancelButton: true,\n            confirmButtonColor: '#d33',\n            cancelButtonColor: '#3085d6',\n            confirmButtonText: 'Deletar'\n        }).then(async result => {\n            if (result.value) {\n                try {\n                    const response = await api.delete('/Funcionario/' + item.id_funcionario);\n\n                    if (response.status === 201 || response.status === 200) {\n                        Swal.fire('Sucesso!', 'Funcionário deletado com sucesso!', 'success');\n                        getFuncionarios();\n                    }\n                } catch (err) {\n                    if (err.response.status === 401 || err.response.status === 400) {\n                        Swal.fire('Erro!', 'Falha ao deletar o funcionário', 'error');\n                    }\n                }\n            }\n        })\n    }\n\n    return (\n        <div className=\"content-wrapper\">\n\n            {/* Content Header (Page header) */}\n            <section className=\"content-header\">\n                <div className=\"container-fluid\">\n                    <div className=\"row mb-2\">\n                        <div className=\"col-sm-6\">\n                            <h1>Funcionários</h1>\n                        </div>\n                        <div className=\"col-sm-6\">\n                            <ol className=\"breadcrumb float-sm-right\">\n                                <li className=\"breadcrumb-item\"><a href=\"#\">Home</a></li>\n                                <li className=\"breadcrumb-item active\">Funcionários</li>\n                            </ol>\n                        </div>\n                    </div>\n                </div>{/* /.container-fluid */}\n            </section>\n\n            {/* Main content */}\n            <section className=\"content\">\n                <div className=\"container-fluid\">\n\n                    <div className=\"card\">\n                        <div className=\"card-header\">\n                            <h3 className=\"card-title\">Lista de funcionários</h3>\n                            <div className=\"card-tools\">\n                                <button className=\"btn btn-success btn-sm\" onClick={handleCadastrar}>\n                                    <i className=\"fas fa-user-plus mr-2\"></i>\n                                                    Novo\n                                </button>\n                            </div>\n                        </div>\n                        <div className=\"card-body p-0\">\n                            <table className=\"table table-striped projects\">\n                                <thead>\n                                    <tr>\n                                        <th style={{ width: '10%' }}>\n                                            ID\n                                        </th>\n                                        <th style={{ width: '40%' }}>\n                                            Nome\n                                        </th>\n                                        <th style={{ width: '20%' }}>\n                                            Tipo\n                                        </th>\n                                        <th style={{ width: '30%' }}>\n                                        </th>\n                                    </tr>\n                                </thead>\n\n                                <tbody>\n\n                                    {funcionarios.map((item, index) => {\n                                        return <tr key={item.id_funcionario}>\n                                            <td name=\"idFuncionario\">{item.id_funcionario}</td>\n                                            <td>\n                                                <a>{item.nome}</a>\n                                                <br />\n                                                {/* <small>Created 01.01.2019</small> */}\n                                            </td>\n                                            <td>\n                                                <a>{item.descricao}</a>\n                                            </td>\n\n                                            <td className=\"project-actions text-right\">\n                                                <button disabled className=\"btn btn-primary btn-sm ml-3\">\n                                                    <i className=\"fas fa-eye mr-2\"></i>\n                                                    Visualizar\n                                                </button>\n                                                <button className=\"btn btn-danger btn-sm ml-3\" onClick={() => deletarFuncionario(item)}>\n                                                    <i className=\"fas fa-trash mr-2\"></i>\n                                                    Deletar\n                                                </button>\n                                            </td>\n                                        </tr>\n                                    })}\n\n                                </tbody>\n                            </table>\n                        </div>\n                        {/* /.card-body */}\n\n                    </div>\n\n                </div>\n            </section>\n            {/* /.content */}\n            {isLoadingVisible ? <Loading /> : null}\n\n        </div>\n    );\n}\n"]},"metadata":{},"sourceType":"module"}