{"ast":null,"code":"import _regeneratorRuntime from\"/home/roberto/\\xC1rea de Trabalho/tingle-bar/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/roberto/\\xC1rea de Trabalho/tingle-bar/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/roberto/\\xC1rea de Trabalho/tingle-bar/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useContext,createContext,useEffect}from'react';import api from'../services/api';import GeralContext from'./geral';var AuthContext=createContext();export var AuthEstabelecimentoProvider=function AuthEstabelecimentoProvider(_ref){var children=_ref.children;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),estabelecimento=_useState2[0],setEstabelecimento=_useState2[1];var _useContext=useContext(GeralContext),setTipoUsuario=_useContext.setTipoUsuario;useEffect(function(){function loadStoragedData(){var storagedEstabelecimento=localStorage.getItem('@TBAuth:estabelecimento');var storagedToken=localStorage.getItem('@TBAuth:token');if(storagedEstabelecimento&&storagedToken){setEstabelecimento(JSON.parse(storagedEstabelecimento));}}loadStoragedData();},[]);function signIn(_x){return _signIn.apply(this,arguments);}function _signIn(){_signIn=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(credentials){var payload,response,accessToken;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;payload={\"Cnpj\":credentials.cnpj,\"Senha\":credentials.senha};_context.next=4;return api.post('/loginestabelecimento',payload);case 4:response=_context.sent;accessToken=response.data.accessToken;delete response.data.accessToken;setEstabelecimento(response.data);localStorage.setItem('@TBAuth:estabelecimento',JSON.stringify(response.data));localStorage.setItem('@TBAuth:token',accessToken);localStorage.setItem('@TBAuth:tipoUsuario','estabelecimento');return _context.abrupt(\"return\",response);case 14:_context.prev=14;_context.t0=_context[\"catch\"](0);return _context.abrupt(\"return\",_context.t0.response);case 17:case\"end\":return _context.stop();}}},_callee,null,[[0,14]]);}));return _signIn.apply(this,arguments);}function signOut(){localStorage.clear();setTipoUsuario(null);setEstabelecimento(null);}return/*#__PURE__*/React.createElement(AuthContext.Provider,{value:{signedEstabelecimento:!!estabelecimento,estabelecimento:estabelecimento,signIn:signIn,signOut:signOut}},children);};export default AuthContext;","map":{"version":3,"sources":["/home/roberto/Área de Trabalho/tingle-bar/src/contexts/auth-estabelecimento.jsx"],"names":["React","useState","useContext","createContext","useEffect","api","GeralContext","AuthContext","AuthEstabelecimentoProvider","children","estabelecimento","setEstabelecimento","setTipoUsuario","loadStoragedData","storagedEstabelecimento","localStorage","getItem","storagedToken","JSON","parse","signIn","credentials","payload","cnpj","senha","post","response","accessToken","data","setItem","stringify","signOut","clear","signedEstabelecimento"],"mappings":"0XAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,UAA1B,CAAsCC,aAAtC,CAAqDC,SAArD,KAAsE,OAAtE,CAEA,MAAOC,CAAAA,GAAP,KAAgB,iBAAhB,CACA,MAAOC,CAAAA,YAAP,KAAyB,SAAzB,CAEA,GAAMC,CAAAA,WAAW,CAAGJ,aAAa,EAAjC,CAEA,MAAO,IAAMK,CAAAA,2BAA2B,CAAG,QAA9BA,CAAAA,2BAA8B,MAAkB,IAAfC,CAAAA,QAAe,MAAfA,QAAe,eACXR,QAAQ,CAAC,IAAD,CADG,wCAClDS,eADkD,eACjCC,kBADiC,+BAE9BT,UAAU,CAACI,YAAD,CAFoB,CAEjDM,cAFiD,aAEjDA,cAFiD,CAIzDR,SAAS,CAAC,UAAM,CACZ,QAASS,CAAAA,gBAAT,EAA4B,CACxB,GAAMC,CAAAA,uBAAuB,CAAGC,YAAY,CAACC,OAAb,CAAqB,yBAArB,CAAhC,CACA,GAAMC,CAAAA,aAAa,CAAGF,YAAY,CAACC,OAAb,CAAqB,eAArB,CAAtB,CAEA,GAAIF,uBAAuB,EAAIG,aAA/B,CAA8C,CAC1CN,kBAAkB,CAACO,IAAI,CAACC,KAAL,CAAWL,uBAAX,CAAD,CAAlB,CACH,CACJ,CAEDD,gBAAgB,GACnB,CAXQ,CAWN,EAXM,CAAT,CAJyD,QAiB1CO,CAAAA,MAjB0C,8HAiBzD,iBAAsBC,WAAtB,mKAEcC,OAFd,CAEwB,CACZ,OAAQD,WAAW,CAACE,IADR,CAEZ,QAASF,WAAW,CAACG,KAFT,CAFxB,uBAO+BnB,CAAAA,GAAG,CAACoB,IAAJ,CAAS,uBAAT,CAAkCH,OAAlC,CAP/B,QAOcI,QAPd,eASgBC,WAThB,CASgCD,QAAQ,CAACE,IATzC,CASgBD,WAThB,CAUQ,MAAOD,CAAAA,QAAQ,CAACE,IAAT,CAAcD,WAArB,CAEAhB,kBAAkB,CAACe,QAAQ,CAACE,IAAV,CAAlB,CACAb,YAAY,CAACc,OAAb,CAAqB,yBAArB,CAAgDX,IAAI,CAACY,SAAL,CAAeJ,QAAQ,CAACE,IAAxB,CAAhD,EACAb,YAAY,CAACc,OAAb,CAAqB,eAArB,CAAsCF,WAAtC,EACAZ,YAAY,CAACc,OAAb,CAAqB,qBAArB,CAA4C,iBAA5C,EAfR,gCAiBeH,QAjBf,4FAmBe,YAAIA,QAnBnB,uEAjByD,yCAwCzD,QAASK,CAAAA,OAAT,EAAmB,CACfhB,YAAY,CAACiB,KAAb,GACApB,cAAc,CAAC,IAAD,CAAd,CACAD,kBAAkB,CAAC,IAAD,CAAlB,CACH,CAED,mBACI,oBAAC,WAAD,CAAa,QAAb,EAAsB,KAAK,CAAE,CAAEsB,qBAAqB,CAAE,CAAC,CAACvB,eAA3B,CAA4CA,eAAe,CAAfA,eAA5C,CAA6DU,MAAM,CAANA,MAA7D,CAAqEW,OAAO,CAAPA,OAArE,CAA7B,EACKtB,QADL,CADJ,CAKH,CAnDM,CAqDP,cAAeF,CAAAA,WAAf","sourcesContent":["import React, { useState, useContext, createContext, useEffect } from 'react';\n\nimport api from '../services/api';\nimport GeralContext from './geral';\n\nconst AuthContext = createContext();\n\nexport const AuthEstabelecimentoProvider = ({ children }) => {\n    const [estabelecimento, setEstabelecimento] = useState(null);\n    const { setTipoUsuario } = useContext(GeralContext);\n\n    useEffect(() => {\n        function loadStoragedData() {\n            const storagedEstabelecimento = localStorage.getItem('@TBAuth:estabelecimento');\n            const storagedToken = localStorage.getItem('@TBAuth:token');\n\n            if (storagedEstabelecimento && storagedToken) {\n                setEstabelecimento(JSON.parse(storagedEstabelecimento));\n            }\n        }\n\n        loadStoragedData();\n    }, []);\n\n    async function signIn(credentials) {\n        try {\n            const payload = {\n                \"Cnpj\": credentials.cnpj,\n                \"Senha\": credentials.senha\n            }\n\n            const response = await api.post('/loginestabelecimento', payload);\n\n            const { accessToken } = response.data;\n            delete response.data.accessToken;\n\n            setEstabelecimento(response.data);\n            localStorage.setItem('@TBAuth:estabelecimento', JSON.stringify(response.data));\n            localStorage.setItem('@TBAuth:token', accessToken);\n            localStorage.setItem('@TBAuth:tipoUsuario', 'estabelecimento');\n\n            return response;\n        } catch (err) {\n            return err.response;\n        }\n    }\n\n    function signOut() {\n        localStorage.clear();\n        setTipoUsuario(null);\n        setEstabelecimento(null);\n    }\n\n    return (\n        <AuthContext.Provider value={{ signedEstabelecimento: !!estabelecimento, estabelecimento, signIn, signOut }}>\n            {children}\n        </AuthContext.Provider>\n    )\n};\n\nexport default AuthContext;"]},"metadata":{},"sourceType":"module"}